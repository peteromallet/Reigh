# Bottom Hover-Activated "Shots Pane" – Implementation Plan

## 1. Goals & UX Overview

• **Discoverability** – When the user moves their cursor to the very bottom ~16-24 px of the viewport, a pane should smoothly slide up (≈ 220 px) revealing groups of "shots".
• **Organisation** – Users can drag images from the Image Gallery (or elsewhere) into:
  1. an existing shot group to append the image; or
  2. an empty area at the end to create a **new** shot group on drop.
• **Lightweight** – Pane hides itself when the cursor leaves its bounds for >300 ms so it doesn't block the canvas.
• **Persisted** – Shot groupings are stored in Supabase (so they appear on reload / across devices) but cached in React-Query for instant UX.

---

## 2. High-Level Architecture

```
<App/>
  └─<Index/>
      ├─<ImageGenerationForm/>
      ├─<ImageGallery/>
      └─<ShotsPane  ✓ new />
```

### 2.1 New Files / Modules

| Path | Purpose |
|------|---------|
| `components/ShotsPane.tsx` | Main hover-activated drawer, houses all shot groups. |
| `components/ShotGroup.tsx` | Displays a single group (thumbnail mosaic + name) and acts as a drop target. |
| `hooks/useShots.ts` | CRUD wrapper around Supabase `shots` + `shot_images` tables using react-query. |
| `supabase/migrations/*` | SQL to create `shots` & `shot_images` tables. |
| `types/shots.ts` | TypeScript interfaces + helpers. |

### 2.2 3rd-party Dependencies

• `@dnd-kit/core` + `@dnd-kit/sortable` – lightweight modern drag-&-drop.
• (Optional) `framer-motion` – for the slide-in animation (already used via shadcn?).

---

## 3. Data Model

```
Table shots {
  id          UUID PRIMARY KEY DEFAULT uuid_generate_v4();
  name        TEXT;
  created_at  TIMESTAMP WITH TIME ZONE DEFAULT now();
}

Table shot_images {
  shot_id     UUID REFERENCES shots(id) ON DELETE CASCADE;
  generation_id BIGINT REFERENCES generations(id) ON DELETE CASCADE;
  position    INTEGER; -- optional ordering
  PRIMARY KEY (shot_id, generation_id)
}
```

Frontend types will be generated by Supabase; helper union type below:
```ts
export interface Shot {
  id: string;
  name: string;
  images: GenerationRow[]; // joined via RPC or react-query useQueries
}
```

---

## 4. UI & Interaction Details

1. **Hover Activation**
   • Invisible 100 vw × 20 px "hot-zone" fixed at bottom: `pointer-events:auto; opacity:0;`.
   • On `mouseenter`, set `isOpen=true` → pane translates `translate-y(0)` over 200 ms.
   • On `mouseleave` of pane, `setTimeout` 300 ms → `isOpen=false` unless cursor returns.

2. **Pane Layout (Tailwind)**
```
<div class="fixed bottom-0 inset-x-0 h-[220px] bg-zinc-900/95 border-t border-zinc-700 shadow-xl">
  <div class="flex gap-4 px-4 py-3 overflow-x-auto scrollbar-hide">
    <ShotGroup /> ... <NewGroupDropZone />
  </div>
</div>
```

3. **ShotGroup**
   • Shows first 3 images stacked or a grid preview.
   • Title editable inline (double-click → input).
   • Whole card is a drop target; highlights on drag over.

4. **NewGroupDropZone**
   • Dashed border box with "Drop here to create new shot".

5. **Drag Sources**
   • Extend `ImageGallery` cards with `Draggable` from dnd-kit.
   • Data payload: `{ generationId, imageUrl, thumbUrl }`.

6. **Drop Handling**
   a. If dropped on existing ShotGroup → `useShots.addImage(shotId, generationId)`.
   b. If dropped on NewGroupDropZone → create shot `name="Untitled"` then add.
   • Optimistic updates via react-query `setQueryData`.
   • Toast feedback on success/failure.

---

## 5. Implementation Steps

1. **DB** – Write migration & run `supabase db push`.
2. **State Hook** – `useShots`
   • `listShots()` – `select shots.*, shot_images(generation_id)`
   • `addImage(shotId, genId)`
   • `createShot(name)`
   • `removeImage` / `deleteShot`
3. **Bottom Pane Component**
   • Hot-zone div + `useState(isOpen)`.
   • Animate with `framer-motion` or CSS transitions.
4. **Drag & Drop Wiring**
   • Wrap `<App>` (or just relevant subtree) with `DndContext`.
   • In `ImageGallery`, wrap item in `<Draggable id={generationId}>`.
   • In `ShotGroup`, `<Droppable id={shotId}>`.
5. **Optimistic Persistence**
   • On drop, update react-query cache immediately; roll back on Supabase error.
6. **Editable Titles** – Simple controlled input; save to Supabase on blur/Enter.
7. **Unit Tests** (TODO from roadmap)
   • Hook tests for `useShots` (CRUD, optimistic).
   • Cypress e2e: drag image → existing group, and → new group.

---

## 6. Edge-Cases & Notes

• **Auth** – If/when user accounts are added, filter shots by `user_id`.
• **Mobile** – Hover isn't available → expose pane via small "Shots" pill button that toggles.
• **Performance** – Lazy-load images in ShotGroup thumbnails (blur-up technique).
• **Accessibility** – Ensure keyboard alternative: `Space` while a gallery image is focused opens a menu "Add to shot ...".

---

## 7. Timeline (�� estimate)

| Day | Task |
|----|------|
| 1 | DB migration, `useShots` hook setup |
| 2 | Implement `ShotsPane` skeleton + animations |
| 3 | Integrate drag-&-drop, NewGroup drop zone |
| 4 | Persist logic, optimistic updates, toasts |
| 5 | Polishing (titles, mobile toggle, a11y) + tests |

*(Adjust based on complexity / other priorities.)*

---

## 8. Stretch Ideas

• **Storyboard View** – Full-screen board where shots can be reordered.
• **Export** – Download shot as .zip or PDF contact sheet.
• **Collaborative** – Live updating via Supabase Realtime. 