# Project Structure & High-Level Overview (Restructured)

> **Project name**: *Artful Pane Craft* (React + Vite image-generation playground)

---

## 1. Tech Stack

• **Vite + React + TypeScript** – front-end bundling & framework
• **TailwindCSS + shadcn-ui** – styling & component primitives
• **@tanstack/react-query** – server-state caching
• **react-router-dom** – client-side routing
• **@dnd-kit/core & @dnd-kit/sortable** – drag-and-drop interactions
• **Sonner & custom toaster** – notifications
• **Supabase** – Postgres DB, storage buckets & typed client
• **FAL-AI cloud API** – image generation backend
• **Express.js** – Node.js API server framework for backend logic

## 1.1 Application Ports

• **Frontend (Vite)**: Port 2222 – Development server for the React application
• **Backend (Express)**: Port 8085 (default, configurable via `process.env.PORT`) – API server handling backend operations

---

## 2. Directory Layout (top-level)

| Path        | Purpose                                                                 |
|-------------|-------------------------------------------------------------------------|
| `/src/app`    | Core application setup (entrypoint, global providers, routing shell)      |
| `/src/pages`  | Top-level page components (e.g., Tool Selector, NotFound)               |
| `/src/tools`  | Parent directory for all distinct tool modules                          |
| `/src/shared` | Components, hooks, utilities, contexts, and layouts shared across tools |
| `/src/server` | Node.js API server (Express.js) for backend operations, data access, and background task processing services (e.g., `services/taskProcessingService.ts`). Includes routes for `projects`, `shots`, `generations`, and `tasks`. |
| `/src/types`  | Shared TypeScript interfaces (non-DB & DB types generated by Supabase)  |
| `/src/integrations` | Supabase client, FAL-AI client setup (if any specific setup needed) |
| `/public`     | Static assets (favicons, placeholder SVG, JSON, etc.)                   |
| `/supabase`   | CLI/config for connecting to the Supabase project                     |
| `/dist`       | Build output (auto-generated)                                           |
| Config files  | `vite.config.ts`, `tailwind.config.ts`, `tsconfig*.json`, ESLint, etc.  |

### 2.5 Database Setup & Dual Backend (Drizzle ORM)

This project uses Drizzle ORM to manage database schema, migrations, and data access, supporting both a local SQLite database for local use and a remote PostgreSQL database (Supabase) for production/web environments.

| Path                        | Purpose                                                                  |
|-----------------------------|--------------------------------------------------------------------------|
| `drizzle.config.ts`         | Drizzle Kit configuration for PostgreSQL (Supabase). Used for generating migrations for PG. |
| `drizzle-sqlite.config.ts`  | Drizzle Kit configuration for SQLite. Used for generating migrations for local SQLite. |
| `/db/schema/schema.ts`      | Canonical database schema definition using Drizzle ORM (PostgreSQL-first). |
| `/db/migrations/`           | Directory for Drizzle-generated PostgreSQL migration files.                |
| `/db/migrations-sqlite/`    | Directory for Drizzle-generated SQLite migration files.                  |
| `/db/seed.ts`               | Script to seed the local SQLite database with initial data for development. |
| `/src/lib/db/index.ts`      | Runtime Data Access Layer (DAL). Initializes and exports a Drizzle client instance (`db`) for server-side use (Node.js environment with SQLite/Postgres) and a Supabase JS client instance for client-side use (browser environment). The API server utilizes the Drizzle instance for database operations. |

**Workflow Overview:**
1.  **Schema Definition**: The single source of truth for the database schema is `/db/schema/schema.ts`, written using Drizzle ORM's TypeScript syntax (primarily targeting PostgreSQL types).
2.  **Migration Generation**: 
    - For PostgreSQL: `npm run db:generate:pg` uses `drizzle.config.ts`.
    - For SQLite: `npm run db:generate:sqlite` uses `drizzle-sqlite.config.ts`.
3.  **Migration Application**:
    - PostgreSQL migrations are applied to Supabase (e.g., via Supabase CLI or a CI step).
    - SQLite migrations (`npm run db:migrate:sqlite`) are applied to the local `./local.db` file.
4.  **Runtime DAL**: 
    - The **API server** imports the `db` object from `/src/lib/db/index.ts` to get a Drizzle client (SQLite or PostgreSQL based on server environment).
    - The **client-side application** imports the `db` object from `/src/lib/db/index.ts` to get a Supabase JS client for direct Supabase interactions (e.g., storage, auth) or uses API calls for database operations.
5.  **Seeding**: `npm run db:seed:sqlite` populates the local SQLite database.

---

## 3. Source Code Breakdown

### 3.1 Core Application (`src/app/`)

```text
src/app/main.tsx   – Mounts <App/> to #root
src/app/App.tsx    – Global providers (QueryClient, LastAffectedShot, Project, Tooltip, DndContext).
                 Renders `AppInternalContent` which sets up DND and renders <AppRoutes /> and <Sonner />.
                 `GlobalHeader` is no longer directly rendered here but as part of `Layout.tsx` via `AppRoutes`.
src/app/routes.tsx – Centralized application routing using `createBrowserRouter` and `RouterProvider`.
                 Defines a root layout route (`<Layout />`) that includes `<GlobalHeader />` and an `<Outlet />` for child page components.
src/app/Layout.tsx – Main application layout component. Renders `<GlobalHeader />`, an `<Outlet />` for page content, and `<TasksPane />`. 
                 Adjusts main content margin when `TasksPane` is locked open.
```

### 3.1.1 Environment Configuration (`VITE_APP_ENV`)

The application's behavior, specifically which tools are available on the `ToolSelectorPage.tsx`, can be controlled via the `VITE_APP_ENV` environment variable. This allows for different sets of tools to be displayed based on whether the app is running in a development (`dev`), local (`local`), or web/production (`web`) context.

**Key Environment Variables:**
*   `VITE_APP_ENV`: Controls tool visibility (`dev`, `local`, `web`). Default: `dev`.
*   `VITE_API_TARGET_URL`: Specifies the target URL for the Vite development server's API proxy (e.g., `http://localhost:3001`). This URL is also used by client-side code as the base for constructing absolute URLs to assets (images, videos) when their stored paths are relative.

**How to Set Environment Variables:**

1.  Ensure a `.env.local` file exists in the root of your project. If not, create one.
2.  Add or modify the `VITE_APP_ENV` variable in this file:
    ```env
    VITE_APP_ENV=your_desired_env
    ```
3.  Replace `your_desired_env` with one of the values: `dev`, `local`, or `web`.
4.  **Important**: Restart your Vite development server after changing this variable for the new setting to take effect.
5.  If `VITE_APP_ENV` is not set, it defaults to `dev`.

**How Tool Visibility is Determined:**

Tool visibility is managed within `src/pages/ToolSelectorPage.tsx`.

1.  **Environment Types**: The possible environment values (`dev`, `local`, `web`) are defined as constants in `src/types/env.ts` (e.g., `AppEnv.DEV`, `AppEnv.LOCAL`, `AppEnv.WEB`).
2.  **Tool Configuration**: Each tool defined in the `tools` array in `ToolSelectorPage.tsx` has an `environments` property. This property is an array that should include the `AppEnv` constants for each environment in which the tool should be visible.

    *Example Tool Definition in `ToolSelectorPage.tsx`:*
    ```typescript
    // ... imports including AppEnv from '../types/env'
    const tools: Tool[] = [
      {
        name: 'My Awesome Tool',
        path: '/tools/my-awesome-tool',
        description: 'This tool does awesome things.',
        environments: [AppEnv.DEV, AppEnv.LOCAL], // This tool will show for 'dev' and 'local'
      },
      {
        name: 'Web Only Tool',
        path: '/tools/web-only-tool',
        description: 'This tool is only for web.',
        environments: [AppEnv.WEB], // This tool will only show for 'web'
      },
      // ... other tools
    ];
    ```
3.  **Filtering Logic**: `ToolSelectorPage.tsx` reads the `VITE_APP_ENV` value (via `import.meta.env.VITE_APP_ENV`). It then filters the `tools` array, displaying only those tools whose `environments` array includes the current `VITE_APP_ENV` value.

To change which tools appear for a specific environment, you need to modify the `environments` array for the respective tool(s) within `src/pages/ToolSelectorPage.tsx`.

### 3.2 Top-Level Pages (`src/pages/`)

• **`src/pages/ToolSelectorPage.tsx`** – Main entry point of the application. Displays a grid of available tools (Image Generation, Video Travel, etc.).
• **`src/pages/NotFoundPage.tsx`** – Fallback page for 404 errors.
• **`src/pages/ShotsPage.tsx`** – Displays a list of all shots for the selected project (using `ShotListDisplay`). Allows selecting a shot to view and manage its images (using `ShotImageManager`).

### 3.3 Tool Modules (`src/tools/`)

#### 3.3.1 Image Generation Tool (`src/tools/image-generation/`)

• **`pages/ImageGenerationToolPage.tsx`**: Main UI for the image generation workflow.
  – Fetches previously saved generations.
  – Hosts `ImageGenerationForm`, progress indicator, `ImageGallery`.
  – Orchestrates FAL-AI workflow, tracks progress, persists images.
  – Handles upscaling, deletion, and optimistic UI updates for generations.
• **`components/ImageGenerationForm.tsx`**: Multi-step form for prompts, LoRAs, controls, starting image. Persists state to `localStorage`.
• **`components/BulkEditControls.tsx`, `components/PromptGenerationControls.tsx`**: Helper toolbars.
• `hooks/useGenerations.ts`: Placeholder hooks for generation listing, deletion, upscaling.

#### 3.3.2 Video Travel Tool (`src/tools/video-travel/`)

• **`pages/VideoTravelToolPage.tsx`**: Main UI for the video travel/creation workflow.
  – Lists shots for the selected project using `ShotListDisplay`.
  – Allows creation of new shots (via API).
  – Hosts `VideoEditLayout` when a shot is selected for configuring video segments and managing images within that shot.
• **`components/VideoEditLayout.tsx`**: Component for configuring and generating video segments from image pairs within a shot. Also allows uploading new images directly to the selected shot. Displays a section for "Output Videos" if any generated videos are associated with the shot. Uses `ShotImageManager` for image list management.
• **`components/TaskDetailsModal.tsx`**: A dialog that displays the detailed parameters of a generation task. It's triggered from an info button on a generated video and fetches task details based on the generation ID.
• **`components/VideoShotDisplay.tsx`**: Component to display a shot's images and name. Allows selection of the shot for editing. Includes UI for inline editing of the shot name and deleting the shot (both via API calls). Used by `ShotListDisplay`.
• **`components/ShotListDisplay.tsx`**: Component that takes a list of shots and renders them using `VideoShotDisplay` components. Used by `VideoTravelToolPage.tsx` and `ShotsPage.tsx`.
• **`components/SortableImageItem.tsx`**: A sub-component used by `ShotImageManager` to render each image in a sortable and deletable manner for the shot management UI.
• **`components/CreateShotModal.tsx`**: A dialog for creating new shots for the current project.
• `hooks/` (if any specific emerge)
• `utils/` (if any specific emerge)

#### 3.3.3 Edit Travel Tool (`src/tools/edit-travel/`)

• **`pages/EditTravelToolPage.tsx`**: Main UI for editing an input image using text prompts.
    – Allows uploading a single input image.
    – Integrates `PromptEditorModal` for managing multiple edit prompts.
    – Inputs for "images per prompt" and "aspect ratio".
    – "Generate" button to trigger Fal API (`fal-ai/flux-pro/kontext`).
    – Displays results in `ImageGallery`.
    – Saves edits to Supabase `generations` table with specific metadata.
• **`components/EditTravelForm.tsx`**: (Currently minimal) Placeholder for any grouped form elements if needed.
• `hooks/` (if any specific emerge for this tool)

### 3.4 Shared Elements (`src/shared/`)

#### `src/shared/components/`
• **`GlobalHeader.tsx`**: Site-wide header with branding, project selector, project settings button, and a '+' button for creating new projects. Includes navigation links (e.g., "Shots" link to `/shots`).
• **`ShotsPane/`**:
    – `ShotsPane.tsx`: Sticky bottom drawer for "shots" (lightweight collections).
    – `ShotGroup.tsx`: Droppable area for images within a shot.
    – `NewGroupDropZone.tsx`: Target to create a new shot by dropping an image.
• **`ui/`**: Nearly 50+ re-exports/variants of shadcn components (Button, Card, Dialog, etc.).
• **`DraggableImage.tsx`**: Wrapper for making gallery images draggable.
• **`ImageGallery.tsx`**: Displays generated images; supports delete, upscale, "apply settings", drag-to-shot.
• **`SettingsModal.tsx`**: Modal to enter and save API keys to `localStorage`.
• **`PromptEditorModal.tsx`**: Modal for bulk prompt creation/editing, AI-assisted generation and refinement.
• **`LoraSelectorModal.tsx`**: Browse and select LoRA models.
• **`CreateProjectModal.tsx`**: A dialog component that allows users to enter a name for a new project. It uses the `addNewProject` function from `ProjectContext` to create the project, which is then automatically selected.
• **`ProjectSettingsModal.tsx`**: A dialog component that allows users to update the name and aspect ratio of an existing project. Uses `ProjectContext.updateProject`.
• **`FileInput.tsx`**: Reusable component for file input (image/video) with drag-and-drop and preview.
• **`ShotImageManager.tsx`**: Reusable component for displaying and managing a list of images within a shot. Handles drag-and-drop reordering and deletion of images via callbacks. Used by `VideoEditLayout.tsx` and `ShotsPage.tsx`.
• **`TasksPane/`**:
    – `TasksPane.tsx`: Slide-out panel from the right, activated on hover or can be locked open. Displays a list of tasks. Communicates lock state to parent layout for content adjustment.
    – `TaskList.tsx`: Component within `TasksPane` that lists tasks, allows filtering by status, and refreshing the list. Uses `TaskItem`.
    – `TaskItem.tsx`: Displays individual task details and a button to cancel the task.

#### `src/shared/hooks/`
• **`useShots.ts`**: Provides hooks for CRUD operations on `shots` and `shot_generations`.
    – `useCreateShot`: `POST /api/shots`
    – `useListShots`: `GET /api/shots?projectId=` (API returns shots with their ordered `images: GenerationRow[]`)
    – `useAddImageToShot`: `POST /api/shots/shot_generations` (to link an existing generation to a shot)
    – `useDeleteShot`: `DELETE /api/shots/:shotId`
    – `useUpdateShotName`: `PUT /api/shots/:shotId`
    – **`useRemoveImageFromShot`**: Takes `shot_id`, `generation_id`, `project_id`. Calls `DELETE /api/shots/:shot_id/generations/:generation_id` to unlink an image from a shot. Includes optimistic updates.
    – **`useUpdateShotImageOrder`**: Takes `shotId`, `orderedGenerationIds`, `project_id`. Calls `PUT /api/shots/:shotId/generations/order` with a payload `{ orderedGenerationIds: string[] }` to update the `position` of images within a shot. Includes optimistic updates.
    – `useHandleExternalImageDrop`: Orchestrates image upload, generation record creation (via `POST /api/generations`), and linking to a shot (potentially creating the shot first).
• **`useTasks.ts`**: Provides hooks for task management.
    – `useListTasks`: `GET /api/tasks?projectId=&status=` (fetches tasks for a project, optionally filtered by status).
    – `useCreateTask`: `POST /api/tasks` (creates a new task).
    – `useCancelTask`: `PATCH /api/tasks/:taskId/cancel` (updates a task's status to 'Cancelled').
    – **`useUpdateTaskStatus` (Conceptual - API endpoint exists)**: `PATCH /api/tasks/:taskId/status` (updates a task's status to any valid status). For certain task types like 'travel_stitch', when a task is marked 'Complete', the backend `taskProcessingService.ts` poller detects this and handles the creation of associated 'generation' and 'shot_generation' records.
    – `useCancelAllPendingTasks`: `POST /api/tasks/cancel-pending` (updates status of all pending tasks for a project to 'Cancelled').
• **`useLastAffectedShot.ts`**: Hook for `LastAffectedShotContext`.
• **`use-mobile.tsx`**: Media query helper.
• **`use-toast.ts`**: Wrapper for Sonner toasting library.
• **`useAIInteractionService.ts`**: Abstraction for AI-assisted prompt editing.

#### `src/shared/contexts/`
• **`LastAffectedShotContext.tsx`**: Context to remember the last modified shot.
• **`ProjectContext.tsx`**: Manages the selected project ID, fetches available projects, and provides project state to the application. It communicates with the backend API (`/api/projects`) to list, create, and update projects. Persists selection to `localStorage`. The API handles the creation of a "Default Project" if none exist. Provides `addNewProject` and `updateProject` functions (via API) and corresponding loading states (`isCreatingProject`, `isUpdatingProject`).

#### `src/shared/lib/`
• **`imageUploader.ts`**: Uploads files to Supabase storage.
• **`utils.ts`**: General utility functions.
• **`imageCropper.ts`**: Crops uploaded images to supported aspect ratios.

### 3.5 Integrations (`src/integrations/`)
• **`supabase/`**:
  – `client.ts`: Pre-configured Supabase JS client.
  – `types.ts`: Generated TS typings for DB.
• **Fal-AI**: Imported from `@fal-ai/client` within relevant tools/pages.

### 3.6 Types (`src/types/`)
• **`shots.ts`**: TypeScript definitions for Shot, GenerationRow etc. `GenerationRow` includes `id`, `imageUrl`, `thumbUrl`, optional `location` (for canonical media path, e.g., video URL), and optional `type` (e.g., 'video_travel_output').
• **`ai.ts`**: Types related to AI interaction services.
• **`tasks.ts`**: TypeScript definitions for `Task` and `TaskStatus`.
• (Other global or shared type definitions)

### 3.7 Server Routes (`src/server/routes/`)
• **`steerableMotion.ts`**: Express router handling video generation between images.
    – `POST /steerable-motion/travel-between-images`: Creates a new "travel_orchestrator" task for generating video between a sequence of images.
    – Accepts parameters matching Python CLI (image_urls, base_prompts, segment_frames, etc.).
    – Creates orchestrator task in database with UUID for task IDs and timestamps for run IDs.
    – Includes comprehensive logging and error handling.

---

## 4. High-Level Data Flow (Adjusted for Tools)

0.  **User interacts with Project Management (via API Layer)**:
    *   On application load, `ProjectContext` calls `GET /api/projects`. If no projects exist for the user, the API creates a "Default Project" and returns it. `ProjectContext` updates its state with the fetched projects.
    *   User can select an existing Project via the `GlobalHeader` dropdown. This `selectedProjectId` (managed by `ProjectContext`) scopes all subsequent data operations that are project-specific.
    *   User can create a new Project using the '+' button in the `GlobalHeader`, which opens `CreateProjectModal`. `ProjectContext.addNewProject` calls `POST /api/projects` with the new project name. The API creates the project and returns it. The new project is then automatically selected in the UI.
1.  **User selects a tool** from `ToolSelectorPage`.
2.  **If Image Generation Tool:**
    1.  User fills `ImageGenerationForm` on `ImageGenerationToolPage`.
    2.  `ImageGenerationToolPage.handleNewGenerate()`:
        a.  Uploads starting image (if provided) to Supabase Storage.
        b.  Creates a new task in the `tasks` table with `task_type: 'image_generation'`, `project_id` set to `selectedProjectId`, and `params` containing all form data (prompts, image settings, LoRAs, ControlNets, starting image URL, etc.). (Task creation currently direct to Supabase, future: via API)
    3.  `ImageGallery` displays existing `generations` fetched for the `selectedProjectId`. (Generation fetching currently direct, future: via API, unless specific to tool without general API endpoint)
3.  **If Video Travel Tool:**
    1.  `VideoTravelToolPage` lists `shots` for the `selectedProjectId` by calling `GET /api/shots` (via `useListShots`). Each shot displayed by `VideoShotDisplay` allows:
        *   Name editing: `PUT /api/shots/:shotId` (via `useUpdateShotName`).
        *   Deletion: `DELETE /api/shots/:shotId` (via `useDeleteShot`).
    2.  User creates a new shot: `POST /api/shots` (via `useCreateShot`).
    3.  User selects a "Shot", loading `VideoEditLayout`.
        *   User uploads a new image to the shot: 
            a.  Image uploaded to Supabase Storage (client-side).
            b.  `POST /api/generations` called to create a generation record.
            c.  `POST /api/shots/shot_generations` called to link generation to shot (via `useAddImageToShot`).
        *   **User manages images within the shot (in `VideoEditLayout`):**
            *   **Reorder images:** `PUT /api/shots/:shotId/generations/order` (via `useUpdateShotImageOrder`) with payload `{ orderedGenerationIds: string[] }`. The API updates the `position` field in the `shot_generations` table for all affected items. Client UI updates optimistically and then refetches shot data.
            *   **Delete image from shot:** `DELETE /api/shots/:shotId/generations/:generationId` (via `useRemoveImageFromShot`). The API removes the corresponding entry from the `shot_generations` table. Client UI updates optimistically and then refetches shot data.
    4.  User configures video segments. Generating video segments for a shot (either individually or batch) now calls `POST /api/steerable-motion/travel-between-images` or `POST /api/tasks` respectively.
        *   `POST /api/steerable-motion/travel-between-images`: Creates a `travel_orchestrator` task in the database, mirroring the Python CLI behavior for generating a video from a sequence of images with specified parameters.
        *   `POST /api/tasks` (with `task_type: 'video_travel_segment'`): Used for generating individual segments between two specific images if that flow is still used.
4.  **If Edit Travel Tool:**
    1.  User uploads an input image/video on `EditTravelToolPage` (to Supabase Storage).
    2.  User manages one or more edit prompts.
    3.  `EditTravelToolPage.handleGenerate()`:
        a.  Uploads the input media to Supabase Storage (if not already done for preview).
        b.  Creates a new task in the `tasks` table with `task_type: 'edit_travel_kontext'` or `'edit_travel_flux'`, `project_id`, and params. (Task creation currently direct to Supabase, future: via API)
    4.  Results (existing `generations`) for the `selectedProjectId` are displayed in `ImageGallery`. (Generation fetching currently direct, future: via API)
5.  **Drag-and-Drop (Global or within relevant tools):**
    – `App.tsx` handles `handleDragEnd`.
    – Operations are project-scoped:
        – Dropping to create a new shot: `POST /api/shots` (via `useCreateShot`).
        – Adding an image to an existing shot (e.g., via `useHandleExternalImageDrop` if it utilizes the refactored flow):
            a.  Image uploaded to Supabase Storage (client-side).
            b.  `POST /api/generations` called to create a generation record.
            c.  `POST /api/shots/shot_generations` called to link generation to shot (via `useAddImageToShot`).
        – External file drops handled by `useHandleExternalImageDrop`: Uploads to Supabase Storage, then uses API calls (`POST /api/generations`, `POST /api/shots/shot_generations`) to create `generations` and associate with `shots`.
6.  **Shots Pane (`ShotsPane.tsx`)** (if active for the current tool):
    – Displays shot data via `GET /api/shots` (through `useListShots`), filtered by `selectedProjectId`.

---

## 5. Persistence Layers

| Layer        | Table / Bucket                                       | Key Columns & Details (from `/db/schema/schema.ts`)                    |
|--------------|------------------------------------------------------|----------------------------------------------------------------------|
| **Postgres** | `users`                                              | `id` (uuid, PK)                                                      |
|              | `projects`                                           | `id` (uuid, PK), `name` (text), `userId` (uuid, FK to `users.id`), `createdAt` (timestamp), `aspectRatio` (text, nullable) |
|              | `tasks`                                              | `id` (uuid, PK), `taskType` (text), `params` (jsonb), `status` (enum: 'Pending', 'In Progress', 'Complete', 'Failed', 'Queued', 'Cancelled'), `dependantOn` (uuid[]), `outputLocation` (text), `createdAt` (timestamp), `updatedAt` (timestamp), `projectId` (uuid, FK to `projects.id`), `generationProcessedAt` (timestamp, nullable) |
|              | `generations`                                        | `id` (uuid, PK), `tasks` (uuid[]), `location` (text), `type` (text), `createdAt` (timestamp), `updatedAt` (timestamp), `projectId` (uuid, FK to `projects.id`) |
|              | `shots`                                              | `id` (uuid, PK), `name` (text), `createdAt` (timestamp), `updatedAt` (timestamp), `projectId` (uuid, FK to `projects.id`) |
|              | `shot_generations`                                   | `id` (uuid, PK), `shotId` (uuid, FK to `shots.id`), `generationId` (uuid, FK to `generations.id`), `position` (integer) |
| (Supabase)   | (Managed by Drizzle ORM, schema above applies)       |                                                                      |
| **SQLite**   | `users`                                              | `id` (text, PK) - SQLite equivalent of uuid                            |
|              | `projects`                                           | `id` (text, PK), `name` (text), `userId` (text, FK to `users.id`), `createdAt` (numeric/text timestamp), `aspectRatio` (text, nullable) |
|              | `tasks`                                              | `id` (text, PK), `taskType` (text), `params` (text - jsonb equivalent), `status` (text enum - including 'Cancelled'), `dependantOn` (text - array equivalent), `outputLocation` (text), `createdAt` (numeric/text timestamp), `updatedAt` (numeric/text timestamp), `projectId` (text, FK to `projects.id`), `generationProcessedAt` (numeric/text timestamp, nullable) |