# Project Structure & High-Level Overview (Restructured)

> **Project name**: *Artful Pane Craft* (React + Vite image-generation playground)

---

## 1. Tech Stack

• **Vite + React + TypeScript** – front-end bundling & framework
• **TailwindCSS + shadcn-ui** – styling & component primitives
• **@tanstack/react-query** – server-state caching
• **react-router-dom** – client-side routing
• **@dnd-kit/core & @dnd-kit/sortable** – drag-and-drop interactions
• **Sonner & custom toaster** – notifications
• **Supabase** – Postgres DB, storage buckets & typed client
• **FAL-AI cloud API** – image generation backend

---

## 2. Directory Layout (top-level)

| Path        | Purpose                                                                 |
|-------------|-------------------------------------------------------------------------|
| `/src/app`    | Core application setup (entrypoint, global providers, routing shell)      |
| `/src/pages`  | Top-level page components (e.g., Tool Selector, NotFound)               |
| `/src/tools`  | Parent directory for all distinct tool modules                          |
| `/src/shared` | Components, hooks, utilities, contexts, and layouts shared across tools |
| `/src/types`  | Shared TypeScript interfaces (non-DB & DB types generated by Supabase)  |
| `/src/integrations` | Supabase client, FAL-AI client setup (if any specific setup needed) |
| `/public`     | Static assets (favicons, placeholder SVG, JSON, etc.)                   |
| `/supabase`   | CLI/config for connecting to the Supabase project                     |
| `/dist`       | Build output (auto-generated)                                           |
| Config files  | `vite.config.ts`, `tailwind.config.ts`, `tsconfig*.json`, ESLint, etc.  |

---

## 3. Source Code Breakdown

### 3.1 Core Application (`src/app/`)

```text
src/app/main.tsx   – Mounts <App/> to #root
src/app/App.tsx    – Global providers:
                 • React-Query client
                 • Tooltip / Toaster context
                 • Drag-and-Drop <DndContext> (if global)
                 • LastAffectedShotProvider
                 Renders <GlobalHeader /> and <AppRoutes />
src/app/routes.tsx – Centralized application routing:
                     • "/" → <ToolSelectorPage />
                     • "/tools/image-generation" → <ImageGenerationToolPage />
                     • "/tools/video-travel" → <VideoTravelToolPage />
                     • "/tools/edit-travel" → <EditTravelToolPage />
                     • "*" → <NotFoundPage /> (handles 404s)
```

### 3.2 Top-Level Pages (`src/pages/`)

• **`src/pages/ToolSelectorPage.tsx`** – Main entry point of the application. Displays a grid of available tools (Image Generation, Video Travel, etc.).
• **`src/pages/NotFoundPage.tsx`** – Fallback page for 404 errors.

### 3.3 Tool Modules (`src/tools/`)

#### 3.3.1 Image Generation Tool (`src/tools/image-generation/`)

• **`pages/ImageGenerationToolPage.tsx`**: Main UI for the image generation workflow.
  – Fetches previously saved generations.
  – Hosts `ImageGenerationForm`, progress indicator, `ImageGallery`.
  – Orchestrates FAL-AI workflow, tracks progress, persists images.
  – Handles upscaling, deletion, and optimistic UI updates for generations.
• **`components/ImageGenerationForm.tsx`**: Multi-step form for prompts, LoRAs, controls, starting image. Persists state to `localStorage`.
• **`components/BulkEditControls.tsx`, `components/PromptGenerationControls.tsx`**: Helper toolbars.
• `hooks/useGenerations.ts`: Placeholder hooks for generation listing, deletion, upscaling.

#### 3.3.2 Video Travel Tool (`src/tools/video-travel/`)

• **`pages/VideoTravelToolPage.tsx`**: Main UI for the video travel/creation workflow.
  – Will allow selection of a "shot" (collection of images).
  – Hosts `VideoEditLayout` for configuring video segments.
• **`components/VideoEditLayout.tsx`**: Component for configuring and generating video segments from image pairs within a shot.
• **`components/VideoShotDisplay.tsx`**: Component to display a shot's images, for selection into the video tool.
• `hooks/` (if any specific emerge)
• `utils/` (if any specific emerge)

#### 3.3.3 Edit Travel Tool (`src/tools/edit-travel/`)

• **`pages/EditTravelToolPage.tsx`**: Main UI for editing an input image using text prompts.
    – Allows uploading a single input image.
    – Integrates `PromptEditorModal` for managing multiple edit prompts.
    – Inputs for "images per prompt" and "aspect ratio".
    – "Generate" button to trigger Fal API (`fal-ai/flux-pro/kontext`).
    – Displays results in `ImageGallery`.
    – Saves edits to Supabase `generations` table with specific metadata.
• **`components/EditTravelForm.tsx`**: (Currently minimal) Placeholder for any grouped form elements if needed.
• `hooks/` (if any specific emerge for this tool)

### 3.4 Shared Elements (`src/shared/`)

#### `src/shared/components/`
• **`GlobalHeader.tsx`**: Site-wide header with branding, dummy project selector, and dummy navigation buttons ("Shots", "Generations").
• **`ShotsPane/`**:
    – `ShotsPane.tsx`: Sticky bottom drawer for "shots" (lightweight collections).
    – `ShotGroup.tsx`: Droppable area for images within a shot.
    – `NewGroupDropZone.tsx`: Target to create a new shot by dropping an image.
• **`ui/`**: Nearly 50+ re-exports/variants of shadcn components (Button, Card, Dialog, etc.).
• **`DraggableImage.tsx`**: Wrapper for making gallery images draggable.
• **`ImageGallery.tsx`**: Displays generated images; supports delete, upscale, "apply settings", drag-to-shot.
• **`SettingsModal.tsx`**: Modal to enter and save API keys to `localStorage`.
• **`PromptEditorModal.tsx`**: Modal for bulk prompt creation/editing, AI-assisted generation and refinement.
• **`LoraSelectorModal.tsx`**: Browse and select LoRA models.
• **`FileInput.tsx`**: Reusable component for file input (image/video) with drag-and-drop and preview.

#### `src/shared/hooks/`
• **`useShots.ts`**: CRUD + optimistic updates for `shots` and `shot_images` tables.
• **`useLastAffectedShot.ts`**: Hook for `LastAffectedShotContext`.
• **`use-mobile.tsx`**: Media query helper.
• **`use-toast.ts`**: Wrapper for Sonner toasting library.
• **`useAIInteractionService.ts`**: Abstraction for AI-assisted prompt editing.

#### `src/shared/contexts/`
• **`LastAffectedShotContext.tsx`**: Context to remember the last modified shot.

#### `src/shared/lib/`
• **`imageUploader.ts`**: Uploads files to Supabase storage.
• **`utils.ts`**: General utility functions.
• **`imageCropper.ts`**: Crops uploaded images to supported aspect ratios.

### 3.5 Integrations (`src/integrations/`)
• **`supabase/`**:
  – `client.ts`: Pre-configured Supabase JS client.
  – `types.ts`: Generated TS typings for DB.
• **Fal-AI**: Imported from `@fal-ai/client` within relevant tools/pages.

### 3.6 Types (`src/types/`)
• **`shots.ts`**: TypeScript definitions for Shot, GenerationRow etc.
• **`ai.ts`**: Types related to AI interaction services.
• (Other global or shared type definitions)

---

## 4. High-Level Data Flow (Adjusted for Tools)

1.  **User selects a tool** from `ToolSelectorPage`.
2.  **If Image Generation Tool:**
    1.  User fills `ImageGenerationForm`.
    2.  `ImageGenerationToolPage.handleGenerate()` orchestrates FAL-AI workflow, saving to `generations`.
    3.  `ImageGallery` displays results.
3.  **If Video Travel Tool:** (Conceptual)
    1.  User selects a "Shot" (collection of images, managed by `useShots`).
    2.  `VideoTravelToolPage` loads the shot images into `VideoEditLayout`.
    3.  User configures video segments between image pairs.
    4.  Generation (e.g., via FAL-AI or other video API) is triggered.
4.  **If Edit Travel Tool:**
    1.  User uploads an input image on `EditTravelToolPage`.
    2.  User manages one or more edit prompts using `PromptEditorModal`.
    3.  User sets "images per prompt" and "aspect ratio".
    4.  `EditTravelToolPage.handleGenerate()` orchestrates Fal API (`fal-ai/flux-pro/kontext`) calls.
    5.  Results are saved to `generations` table and displayed in `ImageGallery`.
5.  **Drag-and-Drop (Global or within relevant tools):**
    – `App.tsx` (if `DndContext` is global) or tool-specific context handles `handleDragEnd`.
    – Dropping on `ShotGroup` or `NewGroupDropZone` uses `useShots` mutations.
6.  **Shots Pane (`ShotsPane.tsx`)** (if active for the current tool):
    – Displays shot data via `useListShots`.

---

## 5. Persistence Layers

| Layer        | Table / Bucket                                       | Key Columns                                                          |
|--------------|------------------------------------------------------|----------------------------------------------------------------------|
| **Postgres** | `generations`                                        | `id`, `image_url`, `prompt`, `seed`, `metadata (JSONB)`, `created_at` |
| (Supabase)   | `shots`                                              | `id`, `name`, `created_at`                                           |
|              | `shot_images` (join table)                           | `shot_id`, `generation_id`, `position`                               |
| **Storage**  | `image_uploads` bucket                               | Raw uploaded images                                                  |
| **LocalStorage** | `fal_api_key`, `openai_api_key`, `replicate_api_key`, `artfulPaneCraftFormSettings`, etc. |                                                                      |

---

## 6. Build / Development Scripts

```bash
npm i        # install deps
npm run dev  # Vite dev server (hot reload)
npm run build
npm run preview
```

---

## 7. Extension Ideas (TODO)

• Fully implement video travel tool functionality.
• Replace mocked AI hooks with real OpenAI calls in image generation tool.
• Auth layer so each user sees only *their* generations & shots.
• Paginate / lazy-load galleries & shots.
• Unit tests for utilities, hooks, and Edge Functions.
• Investigate and resolve any persistent linter path resolution issues.

---

*Generated automatically – update when the project structure changes.*